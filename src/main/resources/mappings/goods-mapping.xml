<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.earthnus.user.goods.GoodsMybatis">

	<resultMap id="goodsResult" type="goods">
		<id property="goods_num" column="GOODS_NUM"/>
		<result property="goods_name" column="GOODS_NAME"/>
		<result property="goods_point" column="GOODS_POINT"/>
		<result property="goods_info" column="GOODS_INFO"/>
		<result property="goods_desc" column="GOODS_DESC"/>
		<result property="goods_img" column="GOODS_IMG"/>
	</resultMap>
	
	<resultMap id="memberResult" type="member">
		<id property="mem_id" column="MEM_ID"/>
		<result property="mem_pw" column="MEM_PW"/>
		<result property="mem_name" column="MEM_NAME"/>
		<result property="mem_addr" column="MEM_ADDR"/>
		<result property="mem_tel" column="MEM_TEL"/>
		<result property="mem_birth" column="MEM_BIRTH"/>
		<result property="mem_gender" column="MEM_GENDER"/>
		<result property="mem_email" column="MEM_EMAIL"/>
		<result property="mem_date" column="MEM_DATE"/>
		<result property="mem_point" column="MEM_POINT"/>
	</resultMap>
	
	<resultMap id="exGoodsResult" type="exGoods">
		<id property="exg_num" column="EXG_NUM"/>
		<result property="exg_id" column="EXG_ID"/>
		<result property="exg_name" column="EXG_NAME"/>
		<result property="exg_addr" column="EXG_ADDR"/>
		<result property="exg_gnum" column="EXG_GNUM"/>
		<result property="exg_gname" column="EXG_GNAME"/>
		<result property="exg_point" column="EXG_POINT"/>
		<result property="exg_date" column="EXG_DATE"/>
	</resultMap>
	
	
	<select id="goodsCount" resultType="int">
		<![CDATA[
			SELECT COUNT(*) FROM GOODS
		]]>
	</select>
	
	<select id="getGoodsList" resultMap="goodsResult">
		<![CDATA[
			SELECT * FROM GOODS ORDER BY GOODS_NUM DESC LIMIT #{contentnum} OFFSET #{pagenum} 
		]]>
	</select>
	
	<select id="getGoods" resultType="goods">
		<![CDATA[
			SELECT * FROM GOODS WHERE GOODS_NUM=#{goods_num}
		]]>
	</select>
	
	<select id="getMember" resultType="member">
		<![CDATA[
			SELECT * FROM MEMBER WHERE MEM_ID=#{auth_id}
		]]>
	</select>
	
	<insert id="insertExGoods">
		<![CDATA[
			INSERT INTO EXGOODS (EXG_ID,EXG_NAME,EXG_GNUM,EXG_GNAME,EXG_POINT,EXG_ADDR) 
			VALUES (#{exg_id},#{exg_name},#{exg_gnum},#{exg_gname},#{exg_point},#{exg_addr})
		]]>
	</insert>
	
	<select id="newExGoods" resultType="int">
		<![CDATA[
			SELECT EXG_NUM FROM EXGOODS WHERE EXG_ID=#{exg_id} ORDER BY EXG_DATE DESC LIMIT 1
		]]>
	</select>
	
	<update id="updateMemberPoint">
		<![CDATA[
			UPDATE MEMBER SET MEM_POINT=MEM_POINT-#{exg_point} WHERE MEM_ID=#{exg_id}
		]]>
	</update>
	
	<select id="exMemberPoint" resultType="member">
		<![CDATA[
			SELECT * FROM MEMBER WHERE MEM_ID=#{exg_id}
		]]>
	</select>
	
	<select id="getExGoods" resultType="exGoods">
		<![CDATA[
			SELECT * FROM EXGOODS WHERE EXG_NUM=#{exg_num}
		]]>
	</select>
	
</mapper>